<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title data-key="title">Aquarium Waterwissel Calculator</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#4facfe">
<!-- 1. Add Marked.js library from a CDN -->
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<style>
    /* Universal Box Model and Font Smoothing */
    *, *::before, *::after {
        box-sizing: border-box;
    }
    body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
        background: linear-gradient(135deg, #74ebd5, #9face6);
        color: #333;
        text-align: center;
        padding: 20px;
        margin: 0;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }
    
    h1 {
        margin-bottom: 30px;
        font-weight: 600;
    }

    .container {
        display: flex;
        flex-direction: column;
        gap: 12px;
        background: rgba(255, 255, 255, 0.95);
        padding: 25px;
        border-radius: 15px;
        max-width: 400px;
        margin: auto;
        box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        text-align: left;
    }

    label {
        font-weight: bold;
        margin-bottom: -4px;
    }

    input, select {
        width: 100%;
        padding: 12px;
        border-radius: 8px;
        border: 1px solid #ccc;
        font-size: 16px;
        background-color: #fff;
    }
    input {
        text-align: right;
    }
    input::placeholder {
        color: #aaa;
    }

    button {
        margin-top: 20px;
        padding: 12px 20px;
        background: #4facfe;
        border: none;
        border-radius: 8px;
        font-size: 18px;
        font-weight: bold;
        color: white;
        cursor: pointer;
        transition: background 0.3s, transform 0.2s;
        align-self: center;
        width: 100%;
    }
    button:hover {
        background: #00c6ff;
        transform: translateY(-2px);
    }

    .result {
        margin-top: 15px;
        font-size: 18px;
        font-weight: bold;
        background: #e0f7fa;
        padding: 12px;
        border-radius: 8px;
        text-align: center;
        width: 100%;
        line-height: 1.5;
    }
    
    .footer-controls {
        display: flex;
        justify-content: space-between;
        align-items: center;
        max-width: 400px;
        margin: 25px auto 0 auto;
    }

    .lang-switcher button {
        background: none;
        border: 1px solid rgba(255, 255, 255, 0.8);
        padding: 5px 10px;
        margin: 0 0 0 10px;
        font-size: 14px;
        cursor: pointer;
        border-radius: 5px;
        color: white;
    }
    .lang-switcher button.active {
        background: #fff;
        color: #4facfe;
        font-weight: bold;
        border-color: #fff;
    }
    
    #about-btn {
        background: none;
        border: none;
        color: white;
        text-decoration: underline;
        cursor: pointer;
        font-size: 14px;
        padding: 5px;
    }

    /* Modal Styles */
    .modal {
        display: none; 
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0,0,0,0.5);
    }
    .modal-content {
        background-color: #fefefe;
        margin: 10% auto;
        padding: 20px 30px;
        border: 1px solid #888;
        width: 90%;
        max-width: 600px;
        border-radius: 15px;
        position: relative;
        text-align: left;
        line-height: 1.6;
    }
    .modal-content h1, .modal-content h2, .modal-content h3 { margin-top: 20px; color: #4facfe; }
    .modal-content h1:first-child, .modal-content h2:first-child { margin-top: 0; }
    .modal-content code { background: #eee; padding: 2px 5px; border-radius: 4px; }
    .modal-content ul, .modal-content ol { padding-left: 20px; }
    .modal-content li { margin-bottom: 8px; }
    .modal-content hr { border: 0; border-top: 1px solid #ddd; margin: 20px 0; }
    .close-btn {
        color: #aaa;
        position: absolute;
        top: 10px;
        right: 20px;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
    }
</style>
</head>
<body>
    <h1 data-key="header">Aquarium Waterwissel Calculator</h1>
    <div class="container">
        <label for="volume" data-key="labelVolume">Aquariuminhoud (liter):</label>
        <input type="number" id="volume" data-key-placeholder="placeholderVolume">

        <label for="parameter" data-key="labelParameter">Parameter:</label>
        <select id="parameter" onchange="updateParameter()">
            <option value="nitrate">Nitraat (NO₃)</option>
            <option value="nitrite">Nitriet (NO₂)</option>
            <option value="phosphate">Fosfaat (PO₄)</option>
            <option value="gh">Algemene Hardheid (GH)</option>
            <option value="kh">Carbonaathardheid (KH)</option>
        </select>

        <label for="start" id="startLabel">Startwaarde (mg/L):</label>
        <input type="number" id="start" placeholder="bijv. 40">

        <label for="target" id="targetLabel">Doelwaarde (mg/L):</label>
        <input type="number" id="target" placeholder="bijv. 10">
        
        <label for="replacement" id="replacementLabel">Waarde in verversingswater (mg/L):</label>
        <input type="number" id="replacement" placeholder="bijv. 5">

        <button onclick="bereken()" data-key="calculateButton">Bereken</button>

        <div class="result" id="result"></div>
    </div>

    <div class="footer-controls">
        <button id="about-btn" data-key="aboutButton">About this Calculator</button>
        <div class="lang-switcher">
            <button onclick="setLanguage('nl')" id="lang-nl">NL</button>
            <button onclick="setLanguage('en')" id="lang-en">EN</button>
        </div>
    </div>

    <!-- About Modal -->
    <div id="about-modal" class="modal">
      <div class="modal-content">
        <span class="close-btn">&times;</span>
        <div id="readme-content">Loading...</div>
      </div>
    </div>

<script>
// Register Service Worker
if ('serviceWorker' in navigator) { navigator.serviceWorker.register('service-worker.js').then(() => console.log("✅ Service Worker registered")).catch(err => console.error("❌ Service Worker error:", err)); }
// --- Data and Translations ---
const translations = { en: { title: "Aquarium Water Change Calculator", header: "Aquarium Water Change Calculator", labelVolume: "Aquarium Volume (liters):", placeholderVolume: "e.g. 200", labelParameter: "Parameter:", paramNitrate: "Nitrate (NO₃)", paramNitrite: "Nitrite (NO₂)", paramPhosphate: "Phosphate (PO₄)", paramGH: "General Hardness (GH)", paramKH: "Carbonate Hardness (KH)", labelStart: "Current Value", labelTarget: "Target Value", labelReplacement: "Replacement Water Value", calculateButton: "Calculate", aboutButton: "About this Calculator", errorMsgGeneric: "❌ Please check all inputs.", errorMsgImpossible: "❌ Target is unachievable. Target value must be higher than replacement water value.", errorMsgIneffective: "❌ Water change is ineffective. Replacement water value is higher than or equal to current value.", resultMsg: (liters, percentage) => `💧 You need to change <strong>${liters} liters</strong> of water (${percentage}%).` }, nl: { title: "Aquarium Waterwissel Calculator", header: "Aquarium Waterwissel Calculator", labelVolume: "Aquariuminhoud (liter):", placeholderVolume: "bijv. 200", labelParameter: "Parameter:", paramNitrate: "Nitraat (NO₃)", paramNitrite: "Nitriet (NO₂)", paramPhosphate: "Fosfaat (PO₄)", paramGH: "Algemene Hardheid (GH)", paramKH: "Carbonaathardheid (KH)", labelStart: "Startwaarde", labelTarget: "Doelwaarde", labelReplacement: "Waarde in verversingswater", calculateButton: "Bereken", aboutButton: "Over deze Calculator", errorMsgGeneric: "❌ Controleer alle invoer.", errorMsgImpossible: "❌ Doel is onbereikbaar. Doelwaarde moet hoger zijn dan de waarde van het verversingswater.", errorMsgIneffective: "❌ Waterwissel is niet effectief. Waarde van verversingswater is hoger dan of gelijk aan de startwaarde.", resultMsg: (liters, percentage) => `💧 Je moet <strong>${liters} liter</strong> vervangen (${percentage}%).` } };
const parameterDefaults = { nitrate: { target: 10,  replacement: 5,   unit: "mg/L", placeholderStart: "e.g. 40" }, nitrite:   { target: 0,   replacement: 0,   unit: "mg/L", placeholderStart: "e.g. 1" }, phosphate: { target: 0.5, replacement: 0.1, unit: "mg/L", placeholderStart: "e.g. 2" }, gh: { target: 6,   replacement: 8,   unit: "°dH",  placeholderStart: "e.g. 12" }, kh: { target: 4,   replacement: 5,   unit: "°dH",  placeholderStart: "e.g. 8" } };
// --- Core Functions ---
function setLanguage(lang) { if (!translations[lang]) lang = 'nl'; document.documentElement.lang = lang; localStorage.setItem('userLanguage', lang); document.querySelectorAll('[data-key]').forEach(elem => elem.innerHTML = translations[lang][elem.getAttribute('data-key')]); document.querySelectorAll('[data-key-placeholder]').forEach(elem => elem.placeholder = translations[lang][elem.getAttribute('data-key-placeholder')]); const select = document.getElementById('parameter'); select.options[0].text = translations[lang].paramNitrate; select.options[1].text = translations[lang].paramNitrite; select.options[2].text = translations[lang].paramPhosphate; select.options[3].text = translations[lang].paramGH; select.options[4].text = translations[lang].paramKH; document.querySelectorAll('.lang-switcher button').forEach(btn => btn.classList.remove('active')); document.getElementById(`lang-${lang}`).classList.add('active'); updateParameter(); document.getElementById('result').innerHTML = ""; }
function updateParameter() { const param = document.getElementById('parameter').value; const defaults = parameterDefaults[param]; const t = translations[document.documentElement.lang]; document.getElementById('target').value = defaults.target; document.getElementById('replacement').value = defaults.replacement; document.getElementById('start').placeholder = defaults.placeholderStart; document.getElementById('startLabel').innerText = `${t.labelStart} (${defaults.unit}):`; document.getElementById('targetLabel').innerText = `${t.labelTarget} (${defaults.unit}):`; document.getElementById('replacementLabel').innerText = `${t.labelReplacement} (${defaults.unit}):`; }
function bereken() { const volume = parseFloat(document.getElementById('volume').value), start = parseFloat(document.getElementById('start').value), target = parseFloat(document.getElementById('target').value), replacement = parseFloat(document.getElementById('replacement').value); const t = translations[document.documentElement.lang], resultDiv = document.getElementById('result'); if (isNaN(volume) || isNaN(start) || isNaN(target) || isNaN(replacement)) { resultDiv.innerHTML = t.errorMsgGeneric; return; } if (target < replacement) { resultDiv.innerHTML = t.errorMsgImpossible; return; } if (replacement >= start) { resultDiv.innerHTML = (start === target) ? t.resultMsg('0.0', '0.0') : t.errorMsgIneffective; return; } localStorage.setItem('aquariumVolume', volume); const changeRatio = (start - target) / (start - replacement); resultDiv.innerHTML = t.resultMsg((volume * changeRatio).toFixed(1), (changeRatio * 100).toFixed(1)); }

// --- About Modal Logic ---

// The old markdownToHtml function has been removed.

function setupModal() {
    const modal = document.getElementById('about-modal');
    const btn = document.getElementById('about-btn');
    const span = document.getElementsByClassName('close-btn')[0];
    const contentDiv = document.getElementById('readme-content');

    btn.onclick = function() {
        modal.style.display = "block";
        fetch('README.md')
            .then(response => response.ok ? response.text() : 'Error: README.md not found.')
            .then(text => {
                // 2. Use marked.parse() to convert markdown to HTML
                contentDiv.innerHTML = marked.parse(text);
            });
    }
    span.onclick = () => modal.style.display = "none";
    window.onclick = (event) => {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }
}

// --- Initialization ---
function initializeApp() { const savedLang = localStorage.getItem('userLanguage'), browserLang = navigator.language.split('-')[0]; const initialLang = (savedLang && translations[savedLang]) ? savedLang : (translations[browserLang] ? browserLang : 'nl'); setLanguage(initialLang); const savedVolume = localStorage.getItem('aquariumVolume'); if (savedVolume) document.getElementById('volume').value = savedVolume; updateParameter(); setupModal(); }

document.addEventListener('DOMContentLoaded', initializeApp);

</script>
</body>
</html>